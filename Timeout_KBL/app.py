import re
import os, uuid, mimetypes, threading, logging
from datetime import datetime
from flask import Flask, request, jsonify, send_from_directory
from flask_cors import CORS
from faster_whisper import WhisperModel
from pymongo import MongoClient
from gtts import gTTS
from google.generativeai import configure, GenerativeModel

# 환경 변수 및 경로 설정
MONGODB_URI = os.environ.get("MONGODB_URI", "mongodb://localhost:27017")
MONGODB_DB  = os.environ.get("MONGODB_DB", "Timeout")
UPLOAD_DIR  = os.environ.get("UPLOAD_DIR", os.path.join(os.path.dirname(__file__), "uploads"))
OUTPUT_FOLDER = os.path.join(os.path.dirname(__file__), "generated_audio")
os.makedirs(UPLOAD_DIR, exist_ok=True)
os.makedirs(OUTPUT_FOLDER, exist_ok=True)

# Flask 앱 설정
app = Flask(__name__)
CORS(app)

# 로깅 설정
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Google Gemini API 키 설정
GOOGLE_API_KEY = "AIzaSyD7xM6BDWOTNwk33KGnUvzpwjrcDiqZEnI"  # 실제 키로 바꾸세요
configure(api_key=GOOGLE_API_KEY)

# Gemini 모델 로딩
gemini_model = GenerativeModel("gemini-1.5-flash")

# Whisper 모델 로딩
model = WhisperModel("small", device="cpu", compute_type="int8")

# MongoDB 연결
client = MongoClient(MONGODB_URI)
db = client[MONGODB_DB]
recs = db.recordings

def clean_wikilinks(text):
    # [[text|display]] → display
    text = re.sub(r'\[\[([^|\]]+)\|([^\]]+)\]\]', r'\2', text)
    # [[text]] → text
    text = re.sub(r'\[\[([^\]]+)\]\]', r'\1', text)
    # [[text#section]] → text (섹션명 제거)
    text = re.sub(r'\[\[([^\[#\|\]]+)(#[^\]]+)?\]\]', r'\1', text)
    return text

# 참조 문서 (요약 시 사용될 프롬프트)
REFERENCE_CONTEXT = """
==== 스크린 플레이 ====
스크린은 공 가진 선수의 공간 확보를 위해 같은 팀 선수가 상대의 진로에 미리 자리잡고 몸으로 [[길막]]하는 것을 말하며, 이 스크린을 활용한 여러 전술들을 통틀어 스크린 플레이라고 한다. 사실상 저지의 역할이므로 상술된 군사용어가 어원이라고 볼 수 있다. 일반적으로 가장 간단하고 기본적인 형태인 [[픽앤롤]], 픽앤팝 등의 2:2 대응 스크린전술을 지칭하는 말로 많이 쓰인다. 어떠한 농구 전술이던지 간에 스크린이 없는 전술은 없을 정도로 농구에서 가장 기본적인 플레이 중 하나이며, 현시대 [[전미 농구 협회|NBA]]에서는 거의 모든 공격상황에 사용하는 가장 기본적이고 필수적인 기술이다.
스크린을 이용한 대표적인 전술인 [[픽앤롤]].

몸만대면 될거 같아 간단해보이지만, 스크린 과정에서 몸을 움직이면 안되고[* 정확히 말하면 발이 움직이면 안되고 스크린 도중에 시전자가 움직이면서 상대 선수의 진로를 방해하면 일리걸스크린으로, 공격자 파울이 선언된다.] 핸들러의 이동을 방해하면 안되기 때문에 위치 선정이 어렵고, 스크린을 걸때 발이 아웃라인을 넘어가 있어도 안 되고, 수비수의 진로를 몸으로 막을 수 있는 피지컬과 부상 위험관리 등 굉장히 어려운 기술이다.

2010년대 후반부터 축구에서도 [[세트피스]]의 중요성이 대두시되자 농구의 스크린 플레이가 더욱 주목받기 시작했다. 기존에도 축구에서 존재했던 전술이지만 농구에서는 기본적인 플레이일 정도로 자주 써먹고 완성도 또한 높기에 많은 축구 감독 및 세트피스 코치들이 농구의 스크린 플레이를 참조하고 있다.
==== 이를 기반으로 하는 팀전술 ====
워낙 잘 알려져 있는 2:2 픽플레이는 [[픽앤롤]] 문서가 있으므로 서술하지 않으며, 아래 서술된 전술 외에도 다양한 전술이 있다. 전술의 이름들은 대체로 그냥 감독이 이름붙인 경우가 많기에 '~한 전술이름은 ~한 형태의 공격이다' 라고 말하기가 힘들다. 다만 플레어(flare : 신속하게 볼 반대로 이동하는 동작), 위브(weave : 물결처럼 드리블과 스크린을 형성하는 플레이)같이 특정 동작이나 움직임을 뜻하는 단어는 있다. 따라서 이런 특정 움직임이 핵심인 전술인 경우 전술명에 저런 용어가 들어가 있는 경우는 있다. 아래 서술된 전술인 플레어 옵션이나 3-맨 위브 같은 전술 이름들도 저런 특정 동작이 핵심인 전술이기에 붙은 이름이다.

===== 엘리베이터 도어 =====
3점슛에 능한 슈터를 살리기 위해 스크리너 두 명이 하이포스트에서 나란히 선 뒤, 슈터가 통과하면 엘리베이터 문을 닫아버리듯 두 명이 마크맨을 스크린하는 것. 스테판 커리와 클레이 탐슨을 보유한 골든스테이트 워리어스의 경기에선 정말 자주 볼 수 있는 전술이다. 딱 봐도 빅맨진과 가드들과의 호흡이 중요한 전술.

여기서 더 나아가 엘리베이터 스크린으로 단순히 슈터를 살리는데 그치지 않고, 가드가 빠져나오거나 빅맨이 빠져 나와서 픽앤롤으로 연결시키기도 한다.

===== 플레어 옵션 =====
볼 핸들러가 올라오는 A에게 패스를 하고, 위크사이드로 이동한다. A가 패스를 받으면, 전체 수비의 밀집도가 A쪽으로 몰리고 A는 다시 볼핸들러에게 다시 패스한다. 패스를 하기 전, 빅맨이 와서 스크린을 걸어주는 등의 도움을 줌과 동시에 수비의 밀집도가 A쪽에 쏠려있기 때문에 다시 패스를 받은 볼핸들러는 비교적 쉽게 공격을 시도할 수 있다.

===== 3-맨 위브 =====
3명의 선수가 드리블, 볼 핸딩, 스크린을 반복하며 공격기회를 만든다.

===== 스태거드 =====

리처드 해밀턴이나 레지 밀러 등 미드레인지/3점 슈터를 살리기 위한 스크린 전술. 골밑에 박혀있다가 베이스라인 등을 타고 돌아나오는 슈터의 진로를 확보해주기 위해 스크리너가 스크린을 서 주는 것이다. 스크리너의 터프하고 안정적인 스크린 능력, 슈터의 베이스라인을 타고 돌아나오는 순발력과 빠르고 정확한 슈팅 릴리즈, 그리고 타이밍에 맞춰 정확하게 패스를 넣어줘야 되는 1번의 패스 능력이 모두 필요한 팀전술이다.

===== 더블 드래그 =====

볼핸들러에게 A가 스크린을 걸고, 볼핸들러에게 스위치 해서 가는 원래 A의 수비수 혹은 스크린을 피해서 수비하러 오는 원래 볼핸들러의 수비수를 B가 다시 스크린을 거는 전술. 볼핸들러에게 극도로 공격찬스를 열어주는 전술이지만 A와 B의 움직임임에 따라 스크리너의 공격찬스도 만들기 쉽다. 또한 스크린이 연달아 두번 일어나는 만큼 수비수의 스위치가 일어날 가능성이 높으므로 전술 직후에 당장 공격기회가 만들어지지 않더라도 미스매치를 이용한 공격을 시도할 수 있다.

===== 스크린 더 스크리너 =====
팀전술이라기보다는 픽앤롤/픽앤팝 등의 부분전술에 가까울 수도 있지만, 볼 없는 상황의 움직임이므로 스크린 부분에 서술한다.


스크리너가 다른 선수에게 픽을 서 주면, 스크린을 받은 선수가 바로 빠져나가다 멈춰 자신에게 픽을 서준 플레이어(screener)에게 바로 픽을 걸어주는 것(screen). 좁은 구역 안에서 두 차례의 스크린이 연속적으로 벌어지고, 골밑슛이나 중장거리 슛 찬스 어느 쪽이건 가능하기 때문에 빅맨보다는 체구가 작고 바로 슛으로 연결할 수 있는 가드들 사이에서 주로 활용된다.

===== 씰 스크린 =====

스윙맨의 돌파를 도와주기 위해 마크맨이 아니라 골밑의 빅맨을 막아주는 스크린.

픽앤슬립과 비슷하게 볼 핸들러의 마크맨을 스크린하는 척 하다가 아래로 빠지면서 엘보나 페인트존 안의 빅맨을 막아주며 돌파를 도와준다.

== 속공 ==

[[농구]]의 공격 전술. 영어로는 Fast Break. --fast attack이 아니다.--[* 688급 잠수함을 "고속 공격용 잠수함"이라는 뜻의 Fast attack submarine'이라고도 불렀는데, 80년대 번역된 [[붉은 폭풍]]이나 [[붉은 10월]]등의 밀리터리 소설에서는 이를 '속공형 잠수함'이라고 불렀다. ~~그럼 그 전의 잠수함은 지공형 잠수함인 건가?~~]

[[스포츠]] 뿐만 아니라 다른 분야에서도 마찬가지이지만 수적 우위가 확보된다면 우세를 달성하기가 매우 쉬워진다. 특히 구기운동에서는 공이 사람보다 빠르기 때문에 2:1, 3:1의 수적 우위가 확보된다면 그 유리함은 이루 말로 표현할 수가 없다. 수비수가 순간이동을 할 수 있는 것도 아니고.

따라서 최대한 '''수적 우위'''를 확보하기 위해 공을 확보한 순간, '''최대한 많은 선수들이 상대편 코트로 달려나가 2:1, 3:1의 수적 우위를 바탕으로 쉽고 빠르게 [[득점]]을 내는 전술'''이 속공이다. 이와는 달리, 다섯 명이 세트된 상태에서 공격을 펼치는 것이 지공.

이를 위해서는 턴오버를 유발할 수 있는 강력한 수비와 미스된 볼을 확보하는 강력한 [[리바운드#s-2]], 40분/48분 내내 뛰어다닐 수 있는 팀원의 탄탄한 체력이 바탕이 돼 있어야 한다.

보통 리바운드를 담당하는 빅맨은 리바운드 능력 외에도 공을 가지고 뛸 가드에게 빠르고 안정적으로 공을 전달해줄 수 있어야 하고, 1차 속공 실패시[* 의외로 체감상 1차 속공의 실패율은 꽤 높다.] 재공격을 위해 빠르게 뒤를 따라갈 수 있어야 한다.[* 이 역할을 트레일러라고 부른다.] 만약 가드를 거치지 않고 뛰어들어가는 피니셔에게 직접 빠르고 정확한 아웃렛 패스를 전달할 수 있다면 금상첨화.

침투해 들어가며 피니시를 담당하는 피니셔, 혹은 백코트 선수는 공을 달고도 빠르게 침투해갈 수 있는 주력과 골밑에서의 확실한 피니시 능력이 필요하다. 이게 말처럼 쉬운 게 아니다. NBA에서는 괴물급 운동능력을 가진 선수들이 득실득실해서 속공해 들어가는 선수들을 순식간에 따라잡아 사뿐히 올려놓는 레이업 슛을 백보드에 찍어버리는 괴수들이 즐비하기 때문. 따라서 속공할 때 차라리 확실하게 덩크로 찍어버리거나 블락을 피할 수 있는 핑거롤, 플로터, 스쿱샷 등 각종 기기묘묘한 기술을 자기 것으로 할 필요가 있다.

상대편 선수의 저지로 1차 속공이 저지된 후에 펼치는 2차 속공, 세컨드 브레이크도 굉장히 중요하다. 앞선에서 한번 저지됐다고 바로 3, 4초씩 볼을 끌면서 지공으로 끌고가는 게 아니라 재빠른 상황 판단 하에 패스 연결에 이은 3점이나 돌파, 빠른 픽앤롤 등 뒤이은 공격전개가 필요한 것. 이걸 예술의 수준으로 펼친 것이 2000년대 중반 [[스티브 내시]]와 [[아마레 스타더마이어]]를 중심으로 했던 [[피닉스 선즈]]였다. 스티브 내시는 피닉스에서의 활약으로 2시즌 연속 MVP를 수상하기도. 다만 공격팀의 숙명답게 NBA 우승에는 실패했다. 05-06시즌의 피닉스 선즈를 다룬 '07 Seconds or Less'라는 제목의 논픽션도 출간돼 있다.

앞에 상대 선수가 없는 단독 속공의 경우 캐스터가 '쇼타임'이라는 말을 하기도 하는데 방해하는 상대팀 선수가 없으니 자유자재로 림에 넣어 득점할 수 있다.

KBL, NBA, FIBA 모두 의도적으로 속공을 파울로 저지할 경우엔 속공 파울을 준다.[* FIBA에서는 U-파울로 간주하며, KBL에서도 FIBA를 따라 U-파울로 간주한다.] 이 경우 자유투 2개와 공격권을 준다. 관객 입장에서도 속공이 보기에도 시원시원하고 파울로 경기가 자꾸 끊길 경우 경기가 루즈해지기 때문에 자꾸 속공을 파울로 끊는 팀이나 선수를 보면 짜증이 솟구쳐온다. --파울로 끊지 말고 따라가서 비열블락을 하라고!--

== 런앤건 ==
농구의 경기 전략 중 하나로 포제션을 최대한 많이 가져가며 속공 중심의 공격 위주로 밀어붙이는 전략을 뜻한다. 하프코트 지공, [[모션 오펜스]] 등과 달리 공을 잡는대로 빠르게 돌진하는 스피드와 개인기가 뒷받침 되어야 하기 때문에 웬만한 팀에서는 시도조차 하기 힘들며, 이런 팀들이 정규 시즌에 잘나가다가도 시즌 말미에 체력이 떨어지면 주저 앉으면서 우승과는 거리가 먼 기록을 남기게 되는 사례도 적지 않다.

게다가 런앤건을 제대로 구사하기 위해서는 수비가 필요하다는 아이러니도 존재. 런앤건 자체가 선수비 이후의 빠른 역습이다.[* 런앤건을 완벽하게 구사하며 1980년대를 지배한 쇼타임 레이커스는 공격력에 가려진 강력한 수비력을 가진 팀이었다.] 게다가 흐름이 빠르다보니 덩달아 '''상대팀 공격횟수도 늘어난다.'''[* 이점을 잘보여주는 게 바로 [[골든스테이트 워리어스]]다. 골든스테이트 워리어스의 경기당 평균 실점은 102점대로 하위권이지만, 전문가들에게는 수비가 좋은 팀이라는 평을 듣는다. 이런 일이 일어나는 이유가 바로 포제션 때문. 골든스테이트는 다른팀보다 많이 공격하고 많이 수비하는 팀이기 때문에, 전체 실점은 많지만 같은 포제션을 기준으로 수비력을 따진다면 NBA에서 최상위권의 수비팀인 셈.]

그러나 시청자들이나 농구팬들이 보기에는 일단 제대로 돌아가기만 하면 선수들 개인기의 극한을 볼 수 있으며 경기 스피드도 빠르고 흐름도 격렬하다보니 팬을 상당히 끌어모을 수 있다. 일종의 로망.

런앤건으로 수차례 파이널 우승을 거머쥐며 한 시대를 풍미한 1980년대 중반 쇼타임 레이커스가 유명하다. 그러나 당시 감독인 [[팻 라일리]]는[* 1979년에 로스앤젤레스 레이커스에 코치로 영입, 1981년 감독으로 승진.] 센터에 의한 수비 중심 타입이라 카림 압둘자바와 매직 존슨 같은 센터들의 몸빵수비도 중시한 유기적인 올 코트 농구였다. 실제로 당시 런앤건을 한 팀은 [[덕 모]] 감독과 [[알렉스 잉글리시]]가 이끌던 [[덴버 너기츠]]였다.

|| 일명 '''쇼타임'''이라 불리던 1980년대 중반 [[로스앤젤레스 레이커스]] 전성기 런앤건의 핵심 3인방[br][[카림 압둘자바]], [[제임스 워디]], [[매직 존슨]] ||

그리고 NBA 최고의 런앤건 특화 지도자 [[돈 넬슨]]이 RUN TMC[* 당시 인기 힙합그룹인 [[Run DMC]]에서 따온 이름으로, [[팀 하더웨이]], 미치 리치몬드, [[크리스 멀린]]이라는 리그 최고의 스코어러 3명의 조합을 일컫는다.]를 앞세워 이끈 1980년대 말~90년대 초의 [[골든스테이트 워리어스]], 2000년대 중반 그가 [[배런 데이비스]], [[몬타 엘리스]], 스티븐 잭슨, 제이슨 리차드슨 등과 함께 마찬가지로 이끈 [[골든스테이트 워리어스]],[* 참고로 골든스테이트는 2007년 플레이오프 1라운드에서 8번 시드로 진출해 무려 시즌 MVP [[디르크 노비츠키]]가 이끌던 [[댈러스 매버릭스]]를 4승 2패로 격침시키며 그 유명한 택배 MVP 사건을 일으키기도 했다.] 2000년대 중반 [[마이크 댄토니]]의 '''7 Seconds or less''' 아래에 [[스티브 내시]], [[숀 매리언]], [[아마레 스타더마이어]] 등이 이끈 [[피닉스 선즈]] 등이 유명하다.

사실 역대 공격팀 중 우승까지 한 팀들은 전부 수비와 골밑, 하프코트 오펜스 등을 고루 갖춘 팀들이었고, 1990년대 골든스테이트나 2000년대 피닉스같은 팀들은 한계에 부딪혔다. 1980년대 레이커스의 경우 속공으로 유명하지만 이 팀의 센터는 무려 카림 압둘자바였고, 매직 존슨은 역대 가드 중 최강 포스트업 능력자, 제임스 워디도 포스트업과 뛰어난 피지컬을 기반으로 한 지공 득점에 능했다. 반대로 2000년대 피닉스는 극강의 공격형 빅맨인 아마레 스타더마이어가 있었지만 골밑 수비가 허약했다. 즉, 공격에 올인한 농구는 우승을 노릴 때 한계가 있다는 것이다. 같은 골든스테이트로 예를 들어도 마찬가지로, 1990년대 골든스테이트는 화력은 대단했지만 수비가 약하고 역대 최고의 센터 시대인 1990년대에 골밑이 취약하다는 약점이 있었지만, 반대로 2010년대 골스는 약한 센터진을 극복할 정도로 뛰어난 수비력이 있었다.

KBL에서는 2000-01시즌 [[김태환(농구)|김태환]] 감독의 [[창원 LG 세이커스]]가 [[조성원]], [[조우현]], [[에릭 이버츠]]의 삼각편대를 앞세워 런앤건으로 돌풍을 일으킨 적이 있다. [[한국여자프로농구]]에서는 [[안산 신한은행 에스버드]]팀도 [[최윤아(농구)|최윤아]], [[김단비(1990)|김단비]], [[하은주]]를 앞세운 강한 체력과 개인기를 이용한 런앤건, 올코트 프레스 전술을 사용하여 무려 5연패를 하기도 했다. 이후 2010년대 초반 [[안양 KGC인삼공사]] [[이상범(농구)|이상범]] 감독이 풀코트 프레스와 젊은 선수들의 속도감을 앞세운 런앤건 농구를 통해 창단 첫 우승을 거머쥔 바 있고, 이 풍조는 후임인 [[김승기(농구)|김승기]] 감독 체제에서도 이어져 4강-우승-4강-1회 플옵 실패 이후 다시 3위-우승의 좋은 성적을 거두며 재미와 성적을 모두 잡기도 했다.[* 2021-22 시즌부터는 속공보다는 수비와 3점슛 양궁 농구로 재미를 본다는 평이 많다.] 이외에 속공으로 재미를 보는 팀이 있다면 [[안영준]] 등 테크닉이 좋고 기동력이 뛰어난 빅 포워드들과 KBL 최고의 슬래셔 [[김선형]]을 앞세운 [[서울 SK 나이츠]]가 있다.

이노우에 타케히코의 농구 만화 <[[슬램덩크]]>에서는 주인공팀 [[북산]]과, 전국대회 1차전 상대 [[풍전]]의 런앤건 농구가 잘 알려졌다. 북산이 하프코트 오펜스에도 능한 데[* 북산은 주전 맴버들의 포지션 역할 분담이 잘 되어있기 때문에 다양한 전술을 활용하는 것이 가능하다.] 비해 풍전은 진짜로 공격에 올인한 런앤건 바스켓.그리고 [[쿠로코의 농구]]에서는 주인공팀 [[세이린 고등학교]]가 신설팀이라 선수층이 얇고, 신장대를 비롯한 평균 피지컬이 낮으며, 미드레인지 슈팅 해결사가 없어서 런앤건 스타일을 쓴다.

== 아이솔레이션 ==
[[농구]]의 공격 전술 중 하나로 맨투맨 수비시 공격력이 뛰어난 선수에게 공을 준 다음 공간을 확보해 그 선수가 1대1 공격을 하는 전술이다. ~~[[몰빵 배구|몰빵 농구]]~~

"이딴게 전술인가?" 싶을 수도 있지만, '''개인 능력의 차이가 경기 전체를 좌우'''할 수 있을 정도로 중요한 스포츠가 [[농구]]이기 때문에 아이솔레이션도 상당히 중요한 공격 방법이다.

예를 들어 점수차가 동점에서 많게는 3점차로 지고 있을때 쿼터 혹은 경기가 끝나는 시간이 얼마 남지 않은 경우 개인 능력이 뛰어난 에이스에게 공을 주고 나머지는 공간을 넓혀준다. 이러면 에이스는 상대 수비수와 1대1을 하면 된다. 전술 성격상 에이스에게 볼이 투입되면 패스가 나올 확률이 낮아지기에, 패스로 인한 턴오버의 확률이 낮다는 것이 장점이다. 하지만 상대도 이 전술에 맞춰서 가장 뛰어난 수비수를 붙이기 때문에 에이스에 대한 확신이 없으면 쓸 수 없는 전술이고,  공격수의 개인 능력으로 풀어내는 만큼 공격수의 체력 소모도 극심하다.
따라서 턴오버 1개가 매우 치명적이면서 뒤를 생각하지 않고 모든 것을 쏟아내야하는 경기 막판 클러치타임에 가장 많이 쓰인다.

공격 방식은 보통 코트를 세로로 잘라 한쪽 편에 위치한 에이스에게 공을 투입하고[* 이렇게 공이 위치한 구역이 '''스트롱 사이드'''이다.] 나머지 4명은 공이 없는 반대쪽 외곽 지역에[* 이 구역은 공이 없기 때문에 '''위크 사이드'''.] 적절하게 모여 에이스가 밖으로 빼주는 공을 받을 준비를 한다.

아이솔레이션에서 공격팀의 가장 중요한 점은 상대방의 가장 약한 수비수를 우리팀 공격수가 가장 좋아하는 위치에서 매치하도록 하는 것이다. 예를 들면 미드레인지 점퍼가 뛰어나고 점퍼 타점이 매우 높은 케빈 듀란트가 엘보우 지점에서 상대 가드 수비수와 매치되도록 하는 것이 있다. 반면 수비팀 입장에서 중요한 것은 팀내 최고의 수비수를 상대 공격수에게 매치 시키면서 동시에 공격수가 다소 불편한 위치에서 공을 잡게 하는 것이다.
예를 들어 23년 플레이오프에서 덴버는 듀란트보다 운동능력과 파워에 우위가 있는 애런 고든을 듀란트에게 매치 시켰고, 애런 고든은 특유의 범핑으로 듀란트가 최대한 림과 떨어지는 지점에서 공을 받게 해서 듀란트의 효율을 크게 떨어트렸다.

에이스는 [[가드(농구)|가드]]가 될 수도 있고 [[빅맨#s-2]]이 될 수도 있다. 가드가 에이스인 경우엔 주로 45도 근처에서의 돌파로 아이솔레이션이 시작되며, 빅맨일 경우엔 주로 [[포스트업]] & 나머지 4명의 3점라인 정렬.

90년대까지 NBA는 지역방어가 금지되어 있었으며 대인마크만이 허용돼 있었기 때문에 아이솔레이션이 굉장히 중요시됐다. 협력수비로 운동능력 좋은 에이스들을 틀어막을 수가 없으니 가장 유효한 공격전술이기도 했다. 이 때문에 농구가 단조로워진다는 지적이 일자, 01~02시즌부터 지역방어를 도입했다.

그 뒤로는 [[픽앤롤]] 등의 2:2 전술, [[모션 오펜스]] 등의 3:3 전술이 공격전술의 주류로 떠오르고 아이솔레이션같은 1:1 전술은 최근엔 잘 사용되지 않는 추세이다. 그러나 2010년대 중후반부터 수비전술의 발전으로 최대한 오픈된 공간을 주지 않도록 하자, 역으로 미스매칭을 이용한 아이솔레이션이 중요한 공격방식이 되었다.[* 이를 매치업 헌팅이라고 한다. [[2022년 NBA 플레이오프/컨퍼런스 세미파이널/서부 컨퍼런스|22년 플레이오프 2라운드]]에서, 전성기 시절 현역 최고 포인트가드 수비수였던 [[크리스 폴]]이 2020년대 4년 연속 ALL NBA 1st팀 수상자인 빅사이즈 포인트가드 [[루카 돈치치]]에게 매치업 헌팅을 노골적으로 당하며 21-22시즌 NBA 전체 승률 1위인 피닉스 선즈가 한참 아래의 전력인 댈러스 매버릭스에게 참패를 당하며 플옵에서 탈락한 이후, 매치업 헌팅은 2020년대 초반 NBA의 주요 전술 화두가 되었다.]

아이솔레이션으로 유독 재미를 봤던 NBA 선수들은 1980년대부터 1990년대까지의 [[마이클 조던]][* 불스의 경우 [[트라이앵글 오펜스]]가 안풀릴때는 조던의 아이솔레이션이 주 전술이었다.]과 90년대 말부터 00년대 초중반의 [[앨런 아이버슨]]이 있으며, 2000년대 들어서는 갖가지 득점의 관한 급자탑을 쌓았던 NBA 최고의 스코어러 [[코비 브라이언트]]가 대표적이다. 이후에는 2010년대 후반 득점왕을 쓸어담은 [[제임스 하든]]과 3대 스포 [[케빈 듀란트]], [[카와이 레너드]], [[르브론 제임스]]가 아이솔레이션으로 클러치 득점을 쌓으며 각자의 커리어를 기록했다.

'''Pick and Roll'''
[[농구]]의 공격 전술 중 하나. [[스크린#s-1.2]] 앤 롤(Screen and Roll) 이라고도 부른다.

농구는 공격시 수비자의 [[가드(농구)|가드]]는 가드를, [[빅맨#s-2]]은 빅맨을 마크하게 되는데 [[스크린#s-1.2]]을 통해 매치 상대를 바꿔 미스매치를 유발하고 이를 통해 득점을 뽑아내기 위한 공격전술이다.

3점 라인 외곽에서 볼 핸들러가 공을 잡고 있다가, [[빅맨#s-2]]이 하이 포스트로 나와 볼 핸들러의 경로에 자연스럽게 자리를 잡고 볼핸들러를 쫓아오는 수비수를 [[길막]]해서 볼 핸들러에 붙은 수비를 순간적으로 벗겨낸다. 이것이 스크린 플레이. 스크린을 받아서 순간적으로 볼 핸들러가 수비수를 떨쳐내면 잠깐동안 노마크 찬스가 되므로 이를 통해 다양한 공격 기회가 만들어진다. 상대 매치업이 순간적으로 바뀌므로 스크리너를 마크 해야할 상대 수비수가 볼 핸들러를 쫓아가야 되는데 그러면 스크린을 풀은 빅맨이 다시 노마크가 되고 빅맨에게 다시 패스해 득점하는 것이 픽앤롤의 표준적 플레이.

농구 전술에서 픽앤롤이 처음 등장한 건 1910년대로, 볼 핸들러를 지원해 순간적인 오픈찬스를 만들어내기 위해 고안되었다. 그러다 1950년대 무렵부터 가드와 빅맨의 2대2 플레이로 이루어지는 픽앤롤을 쓰는 팀들이 나오기 시작했고, [[밥 쿠지]]와 [[빌 러셀]]이 픽앤롤을 써먹고 그 뒤 피트 마라비치나 [[래리 버드]] 같은 테크니션들이 빅맨들과 연계해 픽앤롤을 구사했다.

[[래리 버드]]와 [[보스턴 셀틱스]]의 빅맨들이 보여주는 픽앤롤 강의

이를 가장 완벽하게 구사했던 콤비는 [[유타 재즈]]의 [[칼 말론]]과 [[존 스탁턴]] 콤비. 이들의 기술은 이후 2000년대 일리걸 디펜스 룰이 사라지면서 [[지역 방어#s-2]]가 가능해진 NBA에서는 재즈시절엔 주로 엘보(45도)에서 시작되던 것과 달리 위치를 코트 중앙의 탑으로 옮기고, 단순히 픽앤롤 한번으로 빅맨이 패스를 받아먹는 것으로 끝나는게 아니라 공간을 벌려주거나 연쇄적으로 패스를 돌리도록 응용기술을 활용하기 시작하면서 무한히 확장해, 현대 농구, 특히 [[NBA]]에서는 모든 공격플레이의 시작이 픽앤롤이 되었을 정도로 기본기화 되어있다.

농구의 기본이라고 할 수 있는 공격전술이지만 스크린을 반칙없이 잘 걸어주고 패스를 잘 받아줄 수 있으며 기동력이 좋은 빅맨이 필요하며, 롤하는 빅맨에게 적절한 타이밍에 제대로 패스를 넣어줄 수 있는 가드가 필요하기 때문에 아무나 데려다놓고 할 수 있는 전술은 아니다. 어디에서든 기본이 제일 어려운 법. 특히 볼핸들러는 보통 1대1 돌파 드리블과는 달리 팀원을 이용해야하므로 안정적이며 언제든 패스할 수 있는 볼키핑과 빅맨의 방향에 구애받지 않고 이동하며 패스를 뿌리거나 다음플레이를 결정하는 감각이 필요하다. 그게 안되면 애초에 스크린 걸어주러 오는 아군이 방해물에 불과할 뿐이니까. 이때문에 픽앤롤 드리블 기술은 '''명백히 1대1 돌파와는 별개의 기술이며 이것이 되지 않는 선수는 NBA에서 포인트가드로 살아남는 것이 불가능하다.'''

픽앤롤이 기본이 된만큼 픽앤롤 수비도 그에 맞춰 강화되었는데 픽앤롤을 상대로 빅맨이 가드를, 가드를 빅맨이 바꿔서 수비하는 수비방법이 스위치 디펜스이며 스위치 디펜스시 파생되는 미스매치 때문에 스위치 안하고 스크린에 걸린 가드가 스크린을 돌파해 가드를 끝까지 수비할 수도 있다. 기동력 좋고 팔이 긴 빅맨이 있을 경우엔 오픈된 상대편 가드를 재빠르게 압박해 가드가 볼핸들링을 쉽게 못하도록 압박해 시간을 벌어줄 수도 있는데 이것이 헷지로 NBA 빅맨의 가장 기본적인 전술적인 움직임이 되었다.

픽앤롤도 이제 종류가 다양해져서 빅맨의 이동경로에 따라 다양하게 분화되었다. 2010년대에 들어온 이후 대 포인트가드시대가 도래했고, 뛰어난 [[포인트 가드]]를 갖춘 팀은 혼즈 오펜스등의 픽앤롤 극대화 전술을 기본으로 갖추고 있게 되었다. 대표적인 예로는 [[스테판 커리]]를 위한 스크린이 공격의 알파이자 오메가인 14-15시즌 챔피언 [[골든스테이트 워리어스]]가 있다. 심지어 최근에는 볼 핸들링이 좋은 빅맨들이 나타나면서 가드와 빅맨의 역할이 바뀐 인버티드 픽앤롤도 나타났는데, 이 경우엔 돌아들어가는 롤맨이 가드라서 빅맨보다 스피드가 훨씬 빠르기 때문에 패스만 잘 연결되면 훨씬 막기 어렵다. 가드급 볼 터치와 패싱센스를 갖춘 [[니콜라 요키치]]를 축으로 한 [[덴버 너기츠]]가 대표적인데 심지어 이 팀은 가드인 [[자말 머레이]]가 가드치고 사이즈도 큰데다 힘도 좋아서 스크린을 굉장히 잘 서주기 때문에 그 시너지가 더 크다.

== 종류 ==
=== 픽앤롤 ===
기본형 픽앤롤

스크린으로 볼핸들러의 수비수를 벗긴 뒤 스크리너의 수비수가 볼핸들러를 막기 위해 앞으로 나와서 생긴 뒷공간에 스크리너가 틈으로 들어가 패스를 받아먹는 픽앤롤의 기본.

=== 픽앤팝 or 픽앤페이드 ===
픽앤팝

스크린으로 볼 핸들러의 수비수를 벗긴 뒤 스크리너의 수비수가 볼 핸들러를 막기 위해 앞으로 나온 뒤 스크리너가 옆으로 빠지면[* 이 과정을 팝아웃이라고 한다. 반대로 픽앤롤에서 스크리너가 림으로 돌진하는 것은 롤링.], 볼핸들러의 수비수가 원래 자기 [[마크맨(동음이의어)#markman|마크맨]]을 찾는동안 스크리너에게 아무도 안붙게 된다. 이때 스크리너에게 패스를 주면 오픈 찬스가 되고 픽앤팝이 성공한다. 픽앤팝이 성공하면 빅맨에게 노마크 외곽슛 찬스가 순간적으로 발생하기 때문에, 즉시 캐치앤슛으로 중장거리 슛에 능한 스트레치 빅맨의 공격력을 살릴수 있는 전술이다.

위 동영상의 [[케빈 러브]]나 아래 픽앤페이드의 [[디르크 노비츠키]]처럼 직접 슛으로 마무리할수 있으며 [[샌안토니오 스퍼스]]의 경우는 [[토니 파커]]와 [[팀 던컨]]이 픽앤팝으로 만든 [[팀 던컨]]의 찬스때 던컨이 슛하지 않고 [[토니 파커]]와 [[마누 지노빌리]]와의 협력 플레이로 다른 수비수들을 소몰이하듯 끌어들이고 패스하면서 3점슛 찬스를 만들어내기도 한다. 그리고 그 3점슛을 3점 전문 슈터가 넣는 경우가 많았다.

스크린으로 볼핸들러의 수비수를 막는 척하다가 스크리너가 옆공간으로 빠지면 수비수 눈에는 마치 사라지는(fade) 것처럼 보이기 때문에 픽앤팝을 픽 앤 페이드(Pick and Fade)라고 부르기도 한다.(같은 말이다) 상대 수비는 스크린이 실패한 줄 알고 수비수 두명이 볼핸들러를 따라오게 되는데 그렇게 수비수와 스크리너가 벌어지는 것을 보고 롱패스를 주면 스크리너의 앞은 텅비게 된다. 볼핸들러가 순간적으로 2명의 수비수를 상대해야 하므로 볼핸들러가 대처를 잘해야 하고, 스크리너는 중거리슛 찬스가 나므로 슈팅능력을 갖춰야 한다.

=== 픽앤슬립 ===
픽앤슬립

스크린으로 볼핸들러의 수비수를 살짝 막은뒤 미끄러지듯이(slip) 뒷공간으로 파고드는 것을 말한다. 이는 상대의 헷지를 순간적으로 이용하는 것으로 상대가 픽앤롤할 줄 알고 빅맨이 볼핸들러부터 견제하러 헷지를 나가는 것을 보고 볼핸들러의 수비수를 살짝만 막으면 수비수 두명이 일시적으로 볼핸들러에게만 눈이 팔려서 스크리너를 놓치게 되는데 이 틈을 이용한 것. 픽앤롤에 훼이크를 가미한 전술로 두 사람간의 팀웍과 스피드, 빈틈을 찔러주는 타이밍이 생명이다.

동영상에서 보는 대로 [[피닉스 선즈]]의 [[스티브 내시]],[[아마레 스타더마이어]]의 전매특허 기술이다.
=== 스페인 픽앤롤 ===
[[스페인 농구 국가대표팀]]이 2016년 리우 올림픽부터 국제 대회에서 본격적으로 사용하며 알려진 전술이며, 일반적으로 픽앤롤이 2대 2 게임이라면, 스페인식은 한 명을 더 추가한 3대 3 공격 방식의 더욱 창의적인 픽앤롤이다. 
현재 NBA에서 스페인 픽앤롤을 제일 많이 사용하는 휴스턴[* 2016-2017시즌, 휴스턴은 하프코트 오펜스의 '''44%'''를 픽앤롤로 시작했다.]의 기본 대형이다. 볼핸들러로는 [[제임스 하든]]이 나선다. 하든과 림 사이에는 클린트 카펠라와 에릭 고든이 일렬로 서 있는다. 이 때, 3번과 4번인 [[트레버 아리자]]와 [[라이언 앤더슨]]의 위치가 중요하다. 둘은 픽앤롤을 할 공간을 최대한 벌려주기 위해 양 코너에 서 있는다.

카펠라가 A의 스크린을 걸고, 에릭 고든이 B의 스크린을 걸면 작전이 시작된다. 그리고 하든은 스크린을 받아 돌파를 시작하고, 카펠라는 골밑을 향해 돌진한다. 여기까지는 일반적인 픽앤롤과 다를 게 없지만...

하든이 돌파를 시작하는 이 때, 에릭 고든이 3점슛 라인으로 뛰어나간다. 그야말로 스페인 픽앤롤의 화룡점정. 이렇게 되면 수비는 '''에릭 고든이 노마크가 되고, 카펠라의 수비는 미스매치이며, 하든을 막기 위해 도움수비가 나오며 수비 대형이 제대로 깨지는''' 그야말로 최악의 상황을 경험하게 된다.

이 때 하든은 수비수를 유로스텝 등으로 농락하고 레이업, 카펠라에게 앨리웁 패스, 노마크인 에릭 고든에게 패스, 도움수비를 나오며 노마크가 된 아리자나 앤더슨에게 패스하기 등 '''5가지나 되는 선택권'''을 가지게 된다. 결국 모든 작전에서는 마찬가지겠지만, '''스페인 픽앤롤에서 제일 중요한 것은 볼 핸들러의 역량'''이다. 아무리 찬스가 많이 나도, 결국 처음부터 끝가지 모든 것은 볼 핸들러의 결정에 달려있기 때문이다.[* 그리고 제임스 하든은 포인트가드 전향 1년만에 스페인 픽앤롤의 대가가 된다. 위의 하이라이트를 보면 알 수 있겠지만, 하든은 단 1~3초 동안 종합적으로 코트비전을 본 후 최선의 방안을 내린다. 하다못해 돌파를 막기 위해 좀 물러서거나 패스할 상대를 마크하려 떨어지면 '''스텝백 3점'''을 쏜다(...). 어쩌면 이 점이 [[러셀 웨스트브룩]]과 비교되는 점일수도.]

== 수비 전술 ==
픽앤롤이 농구 전술의 기본이 되는 만큼 이미 정형화된 수비법이 많이 존재한다.

=== 드랍 ===
'''드랍 커버리지(Drop Coverage)''', 흔히들 줄여서 드랍이라고 부르며, 소프트(Soft)라고 하기도 한다.
픽앤롤 상황에서 빅맨 수비수가 뒤로 쳐져서 골밑을 사수하는 수비 전술이다. 스크리너의 골밑 진입을 막음과 동시에 볼핸들러의 돌파를 막아 미드레인지 풀업을 강요하고, 온볼 수비수는 재빨리 스크린을 빠져나와 볼핸들러의 슛을 견제한다. 골밑에서 쉬운 득점을 내줄 바에 비효율적인 미드레인지 풀업을 그것도 수비를 단 채로 쏘게 하여 득점 기댓값을 낮추는 전략. 게다가 빅맨 수비수가 무작정 골밑만 막는 게 아니라 핸들러의 점퍼도 견제한다. 대개 사이즈가 좋아 림 프로텍팅에는 능하지만 가드를 막기에는 발이 느린 빅맨이 있는 팀이 사용하는 방법이다. 여기에 온볼 수비수의 스크린 대처와 리커버리에 뛰어나다면 위력은 배가 된다. 볼핸들러의 진입 속도를 늦춰 온볼 수비수가 다시 붙을 수 있도록 다른 수비수들이 도움수비를 가기도 한다.

골밑에 집중하는 수비인 만큼 약점은 스크리너가 골밑에 들어가지 않고 밖으로 나와서 슛을 쏘는 '''픽앤팝'''. 그리고 당연하게도 볼핸들러가 풀업 점퍼를 매우 잘 쏘는 선수라면 수비가 무용지물이 된다. 혹은 드리블과 볼 키핑이 좋은 볼핸들러가 호스티지 드리블이나 스네이크 드리블로 온볼 수비수의 견제로부터 자유로운 상황에서 드랍하는 빅맨 수비수와 거리를 벌린 뒤 비교적 편한 상태에서 쏘는 슛에도 약하다.

[[브룩 로페즈]], [[야니스 아데토쿤보]], [[즈루 할러데이]]가 있는 [[밀워키 벅스]]와, [[루디 고베어]], [[칼앤서니 타운스]], [[제이든 맥대니얼스]]가 있는 [[미네소타 팀버울브스]]가 이 수비로 재미를 봤다.

=== 헤지 ===
'''헤지 앤 리커버리(Hedge and Recovery)''', 줄여서 헷지라고만 부르거나, 쇼(Show)라고 하기도 한다.
빅맨 수비수가 진입하는 스크리너를 잠시 내버려두고 온볼 수비수와 함께 볼핸들러는 압박하는 수비 전술.

== 모션 오펜스의 종류 ==
=== 프린스턴 오펜스 ===

프린스턴 대학교 농구부를 지도하면서 29년 동안 514승 261패를 기록했으며 새크라멘토 킹스의 어시스턴트 코치로도 봉직한 피트 캐릴이 완성한 모션 오펜스이다. 3점 라인 바깥쪽에 네 명, 자유투를 던지는 탑 오브 더 키 부분에 한 명[* 킹스에서는 이 역할을 크리스 웨버나 블라데 디박/브래드 밀러가 맡았다.]이 서는 배치를 기본으로 꾸준한 움직임/드리블/패스 속에 백도어 컷 등을 통한 골밑 공략, 오픈 3점, 볼 없는 곳에서의 스크린 등을 구사하게 된다. 기본적인 선수배치에서부터 알 수 있듯이 BQ가 좋고 패싱스킬이 되는 포스트 플레이어가 필수적으로 필요한 전술이다.

=== [[트라이앵글 오펜스]] ===
모션 오펜스의 다른 한 축은 일명 트리플 포스트에서 변형된 트라이앵글 시스템. 이는 USC 감독이던 샘 베리가 개발해 제자인 [[텍스 윈터]]가 전수받은 뒤 [[필 잭슨]]이 전수 과정에서 완성하여 [[마이클 조던]], [[샤킬 오닐]], [[코비 브라이언트]]를 NBA의 전설로 만들었다. 14-15 시즌엔 필 잭슨이 뉴욕 닉스에 사장으로 취임한 후 트라이앵글 시스템을 도입시키고 있다. ~~멜로는 전설이 되지 못했다고 한다~~

볼이 위치한 스트롱사이드에 세 명이 삼각형을 만들고, 위크사이드에 두 명이 서는 배치가 기본.

기본적으로 트라이앵글의 시작에는 볼핸들러(A)가 외곽의 윙맨 선수(B)에게 볼을 패스해줌과 동시에 스토롱 사이드(공이 있는 쪽) 코너로 가서 B-A-그리고 로우포스트에 있는 선수 C 사이에서 삼각형을 만든다. 혹은 수비의 견제를 받을 경우 반대쪽의 선수 D에게 패스해주고 그쪽 코너로 이동, B가 대신 같은 쪽 로우포스트로 이동함으로서 A,B, 그리고 원래 이쪽 외곽에 있던 선수 E와 함께 삼각형을 구성한다.

기본이 되는 사이드라인 트라이앵글의 경우 포스트 플레이어[* 시카고 불스의 경우엔 4/5번의 공격력이 영 좋지 못했기 때문에 이 꼭지점 역할을 조던이 맡았다. LA레이커스에서는 샤킬 오닐, 파우 가솔이 포스트 플레이어 역할을 담당.]가 페인트존 근처에 서고 15~18ft 정도의 거리를 두고 퍼리미터 플레이어(점프슛이 되는 선수들로 주로 1~3번 플레이어들)가 사이드 3점라인 근처에 서서 삼각형을 이루게 된다. 위크사이드의 두 명은 탑과 반대쪽 엘보우에 서서 코트를 넓히게 된다.

트라이앵글 역시 포스트 플레이어의 패싱 역량이 중요하다. 포스트 플레이어에게 수비가 집중되는 순간 삼각형의 다른 선수나 위크사이드에서 대기타고 있는 선수에게 적절한 킥아웃을 날려줘야 되기 때문이다. [[마이클 조던]], [[샤킬 오닐]]이나 [[파우 가솔]] 모두 이게 가능했던 선수다.[* 시카고 불스의 경우엔 4/5번의 능력이 영 좋지 못했기 때문에 이 역할을 조던이 맡았다. LA레이커스에서는 샤킬 오닐, 파우 가솔이 이 역할을 담당.]

== 스몰 라인업 ==
스몰 라인업의 핵심은 활동량의 우세 + 장거리 야투의 적극적 활용 + 밀리지 않는 [[리바운드#s-2]] 다툼에 있다. [[빅맨#s-2]]은 다른 선수들에 비해 활동량, 또는 경기에서 뛸 수 있는 시간이 적을 수밖에 없기 때문에 48분 내내 속도전을 걸 수 있다면 빠른 경기 페이스를 따라오기 힘든 빅맨이 뛰는 상대팀을 압도할 수 있게 된다. 경기 페이스가 빨라지고 팀의 활동량이 높으며 장거리 야투에 뛰어난 선수들이 많다면 정확한 장거리 야투 시도와 이를 막기 위해 넓힌 상대 수비의 뒷공간 침투 등을 통한 쉬운 득점 등을 이용해 다득점 경기를 펼칠 수 있다. 마지막으로 신장에서 밀리더라도 적극적인 박스아웃과 프런트코트 요원들의 적극적인 리바운드 가담 등을 통해 리바운드에서 우위를 차지해야, 상대방이 경기 템포를 다운시키는 것을 막고 자신들의 페이스로 경기를 가져갈 수 있을 것이다.

이 때문에 스몰 라인업은 비록 이름이 스몰이라고 하더라도 공을 더 많이 소유하는 [[가드(농구)|가드]] 포지션, [[스윙맨#s-3]]들은 동포지션 평균보다 어느 정도 사이즈와 피지컬을 갖춘 선수를 중용한다. 특히 [[슈팅 가드]] 포지션의 경우는 반드시 사이즈가 좋은 선수가 나온다. [[마이애미 히트]]의 [[드웨인 웨이드]]야 올스타 동부 센터라는 우스개 소리까지 듣던 선수였으며, [[피닉스 선즈]]의 [[조 존슨]]이나 [[골든스테이트 워리어스]]의 [[클레이 탐슨]]도 동포지션 대비 상당한 사이즈를 갖춘 선수들. 이 선수들은 슈팅 가드 포지션이지만 속공에 실패했을때 상대의 빅맨을 커버하기도 하고 골밑에서 높이 열세를 메꾸기 위해 협력수비도 부지런히 해야하고, 만약 동료 [[포인트 가드]]의 수비력이 부족할 경우 상대팀 메인 볼핸들러 수비를 하기도 한다. 이쪽도 상당히 만능 수비수로써의 역량이 요구되는 편. 또한, [[파워 포워드]], [[센터(농구)|센터]]등 [[빅맨#s-2]]의 경우는 동포지션보다 키가 작아도 문제가 없지만 발이 빠르고 피지컬이 뛰어난 선수가 중용된다. 여기에 중장거리 슛을 갖춘 [[스트레치 빅맨]]이 특히 우대받는다. 그래서 종종 [[스몰 포워드]]와 파워 포워드 사이에 낀 [[트위너]]형 선수가 수비와 [[3점 슛]]등을 열심히 연습해 스몰 라인업의 센터나 파워 포워드 자리를 차지하기도 한다. 이 때문에, 스피드와 피지컬, 수비를 맞추기 위해 공격에 대해서는 특정 선수의 개인 기량에 의존하는 경우가 적지 않고 이때 나머지 선수들은 볼 소유를 줄이며 [[3&D]] 롤을 수행하는 경우가 대부분이다.

[[르브론 제임스]]는 가까운 시기에 NBA는 이런 스피드, 스몰 라인업의 최적화가 이루어져 2020년 기준 리그 평균의 신장인 6피트 7~8인치(200~3cm)대 선수들 5명만으로 라인업을 구성하는 날이 올 것이라는 주장도 했다. 그의 주장과 거의 유사하게, 실제 2017-18시즌 [[휴스턴 로키츠]]는 6피트 4인치 ~ 6피트 9인치(193cm ~ 205cm) 전후의 비슷비슷한 신장의 라인업을[* [[크리스 폴]], [[에릭 고든]], [[제임스 하든]], [[P.J. 터커]], [[트레버 아리자]].] 들고 나와 [[골든스테이트 워리어스]]와 무한 스몰 라인업 대전을 벌이기도 했다.[* 심지어 2019-20 시즌에는 팀내 유일한 정통 센터였던 [[클린트 카펠라]]를 트레이드하며 [[로버트 코빙턴]]을 데려와 터커를 센터로 세우는 이른바 '''센터커''' 라인업을 가동하기도 했지만, 성과를 거두지 못하고 시즌 후 곧바로 해체되었다.]

최소한 경기장에 나온 5명 모든 인원이 외곽에서의 슛, 드리블 능력이 있어야 한다. 한 명이라도 슛 능력이 좋지 않으면 수비수는 멀리서 수비하는 형식을 취할 것이고 결국 중앙이 비어서 드리블이나 패스로 침투가 쉽다는 장점 자체도 사라지게 된다. 즉, 외곽에서 존재감이 없는 구멍이 생기면 상대 빅맨들에게 쉽게 점수를 내주는 단점만 극대화되어버린다.

== 농구에서의 지역 방어 ==
농구의 가장 기본적인 농구의 수비 방법은 각자 자신의 포지션의 상대선수를 직접 대인방어를 하는 것이다. 그러나 농구의 특성상 경기 내내 1:1 마크를 수행하는 것은 극심한 체력을 소모하게 되며, 수비 약점이 있는 선수가 있을 경우, 집요한 공략대상이 된다.[* 농구 만화 [[슬램덩크]]의 [[강백호(슬램덩크)|강백호]]가 작중 내내 이런 취급을 받았다. [[채치수]]의 도움이 없었다면 강백호는 리바운드 파워가 아무리 강력해도 선발 멤버가 될 수 없었을 것이다.] 이러한 대인방어의 약점을 보완하기 위해 선수들이 개인이 아니라 '''자신에게 할당된 구역을 마크하는 수비전술이 지역방어'''이다.

각 지역을 맡아서 수비하는 방식이기 때문에 각 수비자들의 공동 수비 구역에 위치한 공격자는 1:多로 공격을 진행하게 된다. 이 공격자보다 수비자가 더 많아지는 현상은 골밑으로 갈수록 심해진다. 그런 이유로 다른 수비전략보다 골밑을 지키는데 특화되어 있는 수비전술이다. 지역방어에 대한 전술적 이해가 거의 없는 아마추어들이라도 굳이 지역방어를 고집하는 데는 아무리 엉성한 지역방어라도 기본적인 골밑수비는 맨투맨보다는 탄탄하며, 외곽슛 성공률이 그리 좋지 않은 아마추어 농구에선 굳이 맨투맨으로 외곽 슛을 경계할 필요가 없기 때문.

하지만 오버로드 공격방식[* 대칭을 이루는 지역방어에 대항, 비대칭적으로 공격수를 배치해 수적우위를 가져가는 것. 예를 들어 2명이 수비하는 곳에 3명이서 트라이앵글을 펼치면 돌파/오픈 둘 중에 하나는 무조건 난다.]에 금방 수비진형이 붕괴되는 수비전술이기도 하다. 수비자들의 빠른 스위치와 공격자들의 포메이션에 따른 수비진형 이동이 중요하다.

지역방어의 기본이 되는 2-3 지역방어.

앞선에 한 명을 더 올린 3-2, 혹은 1-2-2.

상대의 원활한 패스를 차단하고 랍 패스 강요를 목적으로 하는 1-3-1.

앞선에 두 명-뒷선에 세 명이 서는 2-3 지역방어[* 동아리나 아마추어 농구에서 제일 많이 쓰인다 왜냐하면 프로보다 상대적으로 3점슛 정확도가 떨어지므로 주로 골밑을 강화하는 2-3 지역방어를 쓴다], 외곽슛 방어를 위해 앞선에 세 명-뒷선에 두 명이 서는 3-2 지역방어, 기동력 있고 팔이 긴 빅맨이 있을 경우 그 빅맨을 하이포스트까지 올려보내 상대편 패스 동선을 차단하고 각종 도움수비를 서게 하는 2-1-2, 아예 기동력있는 빅맨을 맨 앞으로 내세우고 가드를 양 엘보우 지역으로 내보내는 1-2-2(혹은 드롭존) 등이 있다.[* 아마도 가장 잘 알려진 지역방어는 북산이 [[이정환(슬램덩크)|이정환]]과 [[신준섭(슬램덩크)|신준섭]]을 상대로 구사했던 박스 원일 것이다. 인사이드 돌파를 막기 위해 4명이 포스트 공간을 사수하고 외곽슈터를 맨투맨으로 마킹하는 전술.] 선수들 사이의 기량이 고르지 못하고 연습시간이 프로에 미치지 못하는 아마추어 농구에서 주로 사용되며, [[NCAA]]에서는 특정한 지역방어를 경기 내내 구사하는 팀들도 있다. 하지만 지역 방어 자체가 일종의 전술인 만큼 플레이어 5명이 모두 지역방어에 대한 높은 이해도가 있어야 원활히 돌아간다. 지역방어에 대한 개념이 잘못 잡힌 선수가 껴있으면 패스 한두번에 수비진형이 금방 붕괴된다.

이런 지역방어를 깨는 가장 기본적인 방법은 외곽슛 & 강력한 돌파. 지역방어 특성상 수비범위를 마냥 넓힐 수가 없기 때문에 외곽슛이 펑펑 터질 경우는 수비 측에서 괴로워진다. 또한 약간의 공간만 있어도 다 돌파해버리는 돌파괴물들이 있어도 공간이 찢겨나가며 수비 조직력이 붕괴되는 경우가 많다. 이는 [[NBA]]에서 지역방어가 거의 쓰이지 않는 이유이기도 하다. NBA는 전체적으로 운동능력이 뛰어나기 때문에 리그 전반적인 슈팅능력이 현재처럼 높지 않았던 2000년대 초중반에 지역방어가 처음 허용된 이후에도 계속 사용도가 낮다.[* 실제로 지역방어가 풀린 2000-01시즌 중반까지 3점슛을 거의 쏘지 않던 [[마이클 조던]]이 무릎부상 당하기 전까지 평균 25점, 전 시즌 17승 거둔 팀을 26승20패로 이끌고 있었다. 당시 그가 만 38-39세 나이였다는 점, 은퇴 후 3년 공백을 가졌다가 막 복귀했다는 점, 은퇴 전 35세 나이로 28.7점을 기록했다는 점, 당시 기준으로 25점은 리그 7위에 해당하는 높은 수치란 점을 고려하면 조던은 외곽슛을 거의 안 쏘는 선수였음에도, 무릎 부상과 나이가 문제였지 '지역방어로 인한' 경기력 저하는 딱히 겪지 않았다고 볼 수 있다.] 전술적으로는 존 오펜스를 지역방어 파괴전략으로 많이 사용되는 편.

NBA는 [[2000년대]] 초까지 대인방어만을 허용했으나 경기가 단조로워진다는 지적에 따라 01-02시즌부터 지역방어를 허용했다. 다만 완벽한 지역방어 허용은 아니고 수비자 3초 위반 등의 규정으로 인해 실제로는 제한적인 지역방어만 허용되는 상황. 이 때문에 고전적인 지역방어인 2-3 사용이 힘들어져 정통파 센터가 사라지는 원인이 되고 있기도 하다. 04-05시즌부터 핸드체킹이 사라지면서 윙플레이어들이 활개를 치는 반면, 로우포스트 득점원들이 비율이 적어지고 빅맨들의 활동반경을 외곽으로 넓히는 등 트렌드 변화가 이루어졌다. 위에 언급된대로 'NBA식 지역방어' 자체의 한계도 있는데, 핸드체킹이 불가능해지면 더욱 막기 어려워지기 때문.[* 일례로 05-06시즌 코비 브라이언트가 81점을 넣었을 당시에 상대팀 토론토 랩터스는 계속 지역방어를 썼다.물론 토론토가 수비가 약하기도 했지만, 지역방어의 위력이 그렇게까지 강한 것은 아니란 것.]

사실 지역방어가 허용된 이후에도 NBA에서는 그 빈도수가 매우 적다. 2019-20시즌 당시 쓰여진 이 기사에 따르면 이때 시즌 통틀어 100번의 공격권(posession)에 걸쳐 지역방어를 쓴 팀은 30개 팀 중 18개팀이었는데, 그 전 시즌(2018-19)에는 10개팀이었고, 2017-18시즌엔 고작 두 팀이었다고 한다. 또한 경기당 지역방어 횟수로 보면 평균 5번 쓰였는데, 17-18시즌의 6배에 달하는 수치이다. 즉, 2017-18시즌까지 지역방어가 쓰인 횟수가 경기당 1회 미만이란 것. 2000년대 중반부터 댈러스 매버릭스 같은 팀들은 지역방어를 자주 쓰는 것으로 유명했으므로, 이런 팀들이 평균이 올렸을 것을 감안하면 나머지 팀들은 사실상 거의 안 쓰는 것. 또한 지역방어 자체가 그렇게까지 효과적인 방어전술도 아니다. 분석자료에 따르면 지역방어를 상대로 팀들은 공격권당 0.99점을, 맨투맨 수비 상대로는 0.96점을 기록했다고 한다.[* 스티브 커는 이에 대해 "그것(지역방어)를 팀들이 항상 쓰지 않는 이유가 있어요. 선수들을 봉쇄하는데 좋은 방법은 아니죠. 하지만 약점을 노출하거나 템포를 바꾸고 페이스를 바꾸는데는 좋은 방법이에요. 요즘 시대에는 더욱 더 의미가 있죠."라고 코멘트했다.] 즉, 때때로 사용하기 좋은 수비 옵션일 뿐 지역방어 자체가 주류로 자리잡을 정도는 아니라는 것.

단, 지역방어가 허용된다는 것은 곧 '''<과거였다면 일리걸이 불렸을 위치에서 수비수가 대기할 수 있다>'''로 이어진다. 수비자 3초룰의 존재로 골밑을 미리 잠궈두는 수비 형태가 쓰이기 어려워진 대신, 더이상 페인트존 밖에서 일리걸을 의식할 필요가 없어진 선수들이 더 좋은 위치에서 신속하고 질좋은 더블팀 및 트랩디펜스를 가할 수 있다는 점은 무시 못 할 차이이다. 한마디로 '''여전히 지역방어가 잘 쓰이지 않는다는게, 지역방어 허용의 영향력이 미미하다는 말은 결코 될 수 없다는 것.''' 실제로 득점 스팟이 비교적 한정적이고 안쪽에서 볼을 투입받는 로우포스트 득점원들에게는 이게 상당히 큰 타격으로 다가왔다. 현재도 리그에선 일단 지역방어로 분류되지는 않으나 정석적인 맨투맨도 아닌 애매한 형태의 수비가 곧잘 보이는 편이다.

=== 핵 ===
파괴력은 있지만 [[자유투]] 성공률이 좋지 않은 선수에게 반칙을 해 자유투를 강제하는 전술을 말한다. 보통 '''핵-어-xxx'''라고 표현하며, 농구 매니아들은 이게 펼쳐질 경우 '''핵전쟁'''이라고 표현하기도 한다.

[[전미 농구 협회|NBA]]에서 핵이라는 단어를 쓰기 전부터 아마추어 농구나 [[NCAA]]등에선 '파울 작전'이라는 이름으로 성행했으며, 이 시기는 온볼파울이 아닌 팀파울로 자유투를 던질때 원 앤드 원, 초구를 놓치면 2구를 던지지도 않고 바로 인플레이가 되었기 때문에 자유투 구멍이 있으면 더 위력적인 작전이었다. [[농구대잔치]] 때 [[서울 삼성 썬더스|삼성전자]] 소속이었던 [[강을준]]은 이 때문에 당시 기업은행 [[김동광]] 감독에게 디스를 당하기도 했다. '''"야! 반칙하려면 강을준이 같은 애한테 해야지 왜 김현준이한테 하냐고!"'''

포지션 특성상 자유투 성공률이 낮은 선수들은 주로 [[센터(농구)|센터]]나 [[파워 포워드]] 같은 [[빅맨#s-2]]들이기 때문에 거의 대부분 센터들이 피해자(?)가 된다. [[샤킬 오닐]]이나 [[디안드레 조던]] 같은 선수들은 야투 성공률이 60%, 좋을 때는 70% 이상을 기록하기도 하는데, 자유투 성공률은 좋을 때는 60%대, 나쁠 때는 50% 이하로까지 떨어지기 때문에 야투를 허용하느니 그냥 파울을 해버리는 게 단순 기대득점상으로도 이익이다. 또한 상대팀의 경기 흐름을 끊는다는 의미도 있으며, 2010년대의 [[샌안토니오 스퍼스]]처럼 주축 선수들이 노장일 경우엔 주전의 휴식시간을 확보하기 위해 해킹을 하기도 한다.

NBA에서 이름이 붙은 건 2000년대 초반 리그를 지배했던 [[샤킬 오닐]]을 상대하기 위한 '''핵-어-샤크'''가 해킹 작전의 원조격이다. 그러면서도 샤킬 오닐은 낮은 자유투 성공률 따위는 씹어먹는 골밑 지배력으로 [[로스앤젤레스 레이커스]]의 [[3-peat]]를 이끌었고, 시즌 MVP 1회, 파이널 MVP 3연속 수상, 득점왕 1회를 수상할 정도로 압도적인 지배력을 보여주었다. 이런 LA 레이커스의 우승 도전을 저지한 [[디트로이트 피스톤즈]]는 [[엘든 캠벨]]이나 [[벤 월러스]]가 샤크를 1:1로 막으면서 줄 건 주는 대신 그에게서 나오는 패스나 공간창출 등의 파생 효과를 막는 전술을 사용했기 때문에 이 작전이 진짜 효율적인지에 대해 논란이 벌어지기도 했다.

2010년대 중반에는 받아먹기 전문으로 70% 가까운 야투율을 기록하고 있지만 자유투 성공률은 30~40%대를 기록하고 있는 [[디안드레 조던]]이 주로 대상이 되고 있다. 샌안토니오 스퍼스와의 2015년 2월 19일 정규시즌 경기에서는 자유투 28개를 던져 10개만 림을 통과시켰고, [[휴스턴 로키츠]]와의 5월 10일 플레이오프 경기에서는 자유투 34개를 던져 14개를 성공시켰다. [[디트로이트 피스톤즈]]의 [[안드레 드러먼드]] 또한 떠오르는 피폭자 중 한 명.

한국에서는 2015년 12월 10일 현재 통산 자유투 성공률이 52.71%인 [[하승진]]이 해킹 작전의 단골 대상이다. 경기당 30분 조금 안되게 소화하면서 두 자리수 자유투를 던지는 경기가 심심찮게 나오는 편.

상대의 약한 부분을 후벼파는 것이 승리를 위한 전술의 기본이기는 하나 핵작전이 발생하면 인플레이가 자꾸 끊어지고 시원한 [[덩크 슛]]이나 [[속공]], [[3점 슛]]을 보고 싶어하는 시청자들이 자유투만 던지는 [[노잼]] 상황이 돼 버리기 때문에 채널이 돌아가고, 팬들 사이에서도 논란이 많다. 옹호하는 측에서는 '자유투를 못 던지는 선수가 잘못이다, 수틀리면 자유투를 연습해서 잘 넣으면 될 것 아니냐'는 논리. 사실 자유투 성공률이 60% 초중반만 되어도 조던처럼 경기내내 해킹에 시달리지는 않게 된다. 문제는, NBA 리그 환경이 갈수록 공격 속도가 죽고 [[빅맨#s-2]]들이 제대로 슛 던지기 힘든 환경이 조성되면서 핵의 위험에 더 쉽게 노출되고 있는 것. 설사 핵을 당하더라도 그 이상으로 팀의 3점슛 성공률에 공헌하는 공격 [[리바운드#s-2]] 머신 + [[스크린#s-1.2]] 셔틀 빅맨이 늘어나고 있는 것.[* [[빅맨#s-2]], [[센터(농구)|센터]] 항목에도 있는 [[트리스탄 탐슨]] 같은 경우가 극단적인 케이스.]

그러나 반대하는 측에서는 '프로 스포츠의 목적은 재미인데 이에 반하는 핵xx 작전은 금지해야 한다'는 논리이다. 실제로 프로 리그에서는 재미를 위해 '재미없지만 효율적인' 행위를 금지하는 방향으로 규칙 개정이 이뤄져왔는데, 예를 들어 축구의 경우 과거에는 팀 동료가 골키퍼에게 공을 패스할 때 골키퍼가 공을 손으로 잡아도 되었으나 이러한 양상이 경기를 지루하게 만들자 FIFA는 1992년부터 개정된 백패스 규정을 도입하여 더 이상 골키퍼는 패스의 의도로 발로 건네준 공을  손으로 잡을 수 없게 되었다.[* 가슴이나 머리로 건네준 공은 손으로 잡을 수 있다.] 농구에서도 원맨 속공에서 수비가 파울로 끊는 경우 수비 입장에서는 실점을 하는 대신 상대에게 자유투 두개를 주므로 산술적으로 따지면 이득이다. 자유투 성공률은 보통 70~80% 정도인데, 원맨 속공에서 성공률은 거의 100%에 가깝기 때문. 하지만 NBA에서는 보통 원맨 속공 때 가장 화려한 플레이가 나오는데 파울로 끊어버리면 재미를 저하시킨다는 판단 하에 Clear-Path-To-The-Basket 규칙을 신설해 이 때 파울하면 자유투 두 개, 공격권까지 주게 만들었다. 즉, 규칙상 아무리 효율적이라도 실질적으로 경기를 재미가 없게 만든다면 프로 스포츠에서는 충분히 금지할 수 있고 지금까지 그래왔다.

실제로 NBA 총재 [[아담 실버]]는 핵어작전을 제한하는 방안을 논의하자고 제안했고, 이 논의는 현재진행형으로 이뤄지고 있다. 그러나 NBA 사무국은 비교적 규모가 작은 조직이고, 실세는 어디까지나 [[구단주]]들이기 때문에 이런 식으로 특정 팀이 이득을 얻거나 손해를 보는게 명확한 룰을 개정하는 건 쉬운 일이 아니라는 것이 문제다. 각 팀 구단주들의 합의를 이끌어내야 하기 때문... 위에 언급된 clear-path-to-the-basket의 경우 모든 팀들에게 공통적으로 해당되는 상황이었지만, 핵어작전 금지는 이로 인해 혜택을 보는 팀이 소수에 불과하기 때문이다.

08-09시즌 [[샌안토니오 스퍼스]]의 [[그렉 포포비치]] 감독은 [[팬 서비스]]차원에서 '''경기 시작 5초'''만에 [[샤킬 오닐]]에게 반칙을 건 적도 있다. 단, 인텐셔널 파울에 걸려들 가능성이 높으니 주의해야 한다. 상대 자유투 이끌어내겠다고 인텐셔널 파울 2개 걸려서 퇴장당할 수는 없는 노릇이니까.

[[새깅]]: 성공률이 낮은 선수에게 일부러 적극적인 수비를 하지 않음으로써 슛을 던지도록 유도하는 행동. 득점력이 뛰어난 선수에게 2명 이상의 수비수가 붙는 더블팀으로 인해 나머지 선수 중 한명이 자연스럽게 프리가 되는 상황과는 달리 멀쩡히 수비가 있으면서도 내버려두는 것을 지칭한다. 새깅을 당하는 공격수 입장에선 상당한 굴욕.[* [[슬램덩크]]에서 '저 녀석은 들어가지 않아'라며 새깅 당하던 강백호를 떠올리면 된다.] 반대로 새깅 당한 선수가 슛을 성공시키며 의기양양해하는 장면도 나온다. 언뜻 생각하면 초심자들끼리 또는 동네농구에서 발생하는 상황일거 같지만 최고의 리그인 NBA에서 뛰는 선수들도 3점슛이나 특정 스팟에서의 슛 성공률이 유의미하게 차이나는 경우가 많기 때문에 새깅은 빈번하게 발생하는 수비 전략이다.

"""

REFERENCE_CONTEXT = clean_wikilinks(REFERENCE_CONTEXT)

#def build_prompt(context: str, transcript: str) -> str:
#    return f"""{context.strip()}

#[감독의 전사 내용]
#{transcript.strip()}

#위 내용을 바탕으로 감독의 지시 내용을 3줄 이내로 요약해줘."""

def build_prompt(context: str, transcript: str) -> str:
    return f"""You are a helpful basketball assistant.

Based on the context and the coach's instruction below, summarize the coach's intent in **3 sentences or fewer**, in **English**.

[Reference Context]
{context.strip()}

[Coach's Instruction]
{transcript.strip()}

Summary (in English):
"""

def safe_name(mtype: str) -> str:
    ext = mimetypes.guess_extension(mtype or "") or ".webm"
    return f"{uuid.uuid4().hex}{ext}"

def cleanup_file(path):
    try:
        os.remove(path)
    except Exception as e:
        logger.warning(f"파일 삭제 실패: {path}, 이유: {e}")

# 업로드된 오디오 파일 서빙
@app.route("/uploads/<path:fn>")
def serve_upload(fn):
    return send_from_directory(UPLOAD_DIR, fn, as_attachment=False)

# 생성된 음성 파일 서빙
@app.route("/audio/<path:fn>")
def serve_audio(fn):
    return send_from_directory(OUTPUT_FOLDER, fn, as_attachment=True)

@app.route("/upload_audio", methods=["POST"])
def upload_audio():
    if "audio" not in request.files:
        return jsonify({"success": False, "message": "audio 파일 없음"}), 400

    f = request.files["audio"]
    filename = safe_name(f.mimetype)
    upload_path = os.path.join(UPLOAD_DIR, filename)
    f.save(upload_path)

    logger.info(f"오디오 업로드 완료: {upload_path}")

    # 1. Whisper로 전사
    segs_ko, _ = model.transcribe(
        upload_path, task="transcribe", language="ko", vad_filter=True, beam_size=5
    )
    text_ko = "".join(s.text for s in segs_ko).strip()

    # 2) 영어 번역(Whisper translate)
    segs_en, _ = model.transcribe(
        upload_path, task="translate", language="ko", vad_filter=True, beam_size=5
    )
    text_en = "".join(s.text for s in segs_en).strip()

    # 2. Gemini로 요약(한국어)
    prompt = build_prompt(REFERENCE_CONTEXT, text_ko)
    response = gemini_model.generate_content(prompt)
    ai_response = response.text.strip().replace('**', '')

    # 2. Gemini로 요약(영어)
    prompt2 = build_prompt(REFERENCE_CONTEXT, text_en)
    response2 = gemini_model.generate_content(prompt2)
    ai_response2 = response2.text.strip().replace('**', '')

    # 3. gTTS로 음성 생성
    tts = gTTS(text=ai_response2, lang='en', slow=False)
    audio_filename = f"response_{uuid.uuid4().hex}.mp3"
    audio_path = os.path.join(OUTPUT_FOLDER, audio_filename)
    tts.save(audio_path)

    logger.info(f"TTS 생성 완료: {audio_path}")

    # DB 저장
    now = datetime.now().isoformat()
    recs.insert_one({
        "asr_text_ko": text_ko,
        "text-en": text_en,
        "ai_response": ai_response2,
        "audio_url": f'/audio/{audio_filename}',
        'timestamp': now,
        "user": "Head-Coach"
    })

    # 업로드 파일 정리
    threading.Thread(target=cleanup_file, args=(upload_path,), daemon=True).start()

    return jsonify({
        "success": True,
        "message": "전사 및 요약 완료",
        "data": {
            "file_url": f"/uploads/{filename}",
            "asr_text_ko": text_ko,
            "text-en": text_en,
            'ai_response': ai_response2,
            'audio_url': f'/audio/{audio_filename}',
            'timestamp': now,
            "user": "Head-Coach"
        }
    })

#if __name__ == "__main__":
#    app.run(host="0.0.0.0", port=5021, debug=True)

